(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,function(t,e,n){"use strict";n.r(e);var r=n(2),i=n(3);const o=new Map([["1",1],["2",2],["3",3],["4",12],["q",4],["w",5],["e",6],["r",13],["a",7],["s",8],["d",9],["f",14],["z",10],["x",0],["c",11],["v",15]]);const s=document.getElementById("canvas"),c=document.getElementById("select"),u=document.getElementById("game-description"),l=s.getContext("2d"),a=Math.floor(s.width/64),h=Math.floor(s.height/32);let d=new class{constructor(){this.cpu=r.a.new(),this.frequency=0,this.cpu_cycles=0,this.timer_cycles=0,this.audioCtx=new AudioContext,this.oscillator=this.audioCtx.createOscillator(),this.oscillator.type="square",this.oscillator.frequency.value=200,this.oscillator.start(0)}step(t){this.cycleCPU(t),this.updateTimers(t),this.cpu.sound()?this.playSound():this.stopSound()}cycleCPU(t){this.cpu_cycles+=t*this.frequency/1e3;let e=Math.floor(this.cpu_cycles);for(let t=0;t<e;t++)this.cpu.cycle();this.cpu_cycles-=e}updateTimers(t){this.timer_cycles+=60*t/1e3;let e=Math.floor(this.timer_cycles);for(let t=0;t<e;t++)this.cpu.update_timers();this.timer_cycles-=e}load(t,e){this.reset(),this.frequency=t.speed,void 0!==t.load_store_quirk&&this.cpu.set_load_store_quirk(t.load_store_quirk),void 0!==t.shift_quirk&&this.cpu.set_shift_quirk(t.shift_quirk),void 0!==t.wrapping&&this.cpu.set_wrapping(t.wrapping),this.cpu.load(e)}reset(){this.cpu_cycles=0,this.frequency=0,this.oscillator.disconnect(),this.cpu.reset()}playSound(){this.oscillator.connect(this.audioCtx.destination)}stopSound(){this.oscillator.disconnect()}setKey(t,e){this.cpu.set_key(t,e)}get pixelBuffer(){const t=this.cpu.screen_buffer();return new Uint8Array(i.n.buffer,t,2048)}},f=0,p=0,y=null,m=null;fetch("/roms.json").then(t=>{if(!t.ok)throw new Error("Could not get roms.json file.");return t.json()}).then(t=>{y=t.roms;for(let t=0;t<y.length;t++){let e=document.createElement("option");e.appendChild(document.createTextNode(y[t].name)),e.value=t.toString(),c.appendChild(e)}});const w=()=>{l.beginPath(),l.fillStyle="#000000",l.fillRect(0,0,s.width,s.height),l.stroke()},_=()=>{let t=(p=performance.now())-f;d.step(t),k(),f=p,m=requestAnimationFrame(_)},g=(t,e)=>64*t+e,k=()=>{const t=d.pixelBuffer;l.beginPath(),l.fillStyle="#000000",l.fillRect(0,0,s.width,s.height),l.fillStyle="#FFFFFF";for(let e=0;e<32;e++)for(let n=0;n<64;n++){1===t[g(e,n)]&&l.fillRect(n*a,e*h,a,h)}l.stroke()};document.addEventListener("keydown",t=>{const e=t.key,n=o.get(e);void 0!==n&&d.setKey(n,!0)}),document.addEventListener("keyup",t=>{const e=t.key,n=o.get(e);void 0!==n&&d.setKey(n,!1)}),c.addEventListener("change",t=>{c.blur();let e=y[t.target.value];void 0===e?(cancelAnimationFrame(m),requestAnimationFrame(w),d.reset(),u.textContent=""):fetch(e.location).then(t=>{if(!t.ok)throw new Error("Could not get "+e.name+" rom file.");return t.arrayBuffer()}).then(t=>{u.textContent=e.description;let n=new Uint8Array(t);d.load(e,n),f=performance.now(),m=requestAnimationFrame(_)})})},function(t,e,n){"use strict";n.d(e,"a",(function(){return d})),n.d(e,"d",(function(){return f})),n.d(e,"b",(function(){return p})),n.d(e,"e",(function(){return m})),n.d(e,"c",(function(){return w}));var r=n(3);let i=null;function o(){return null!==i&&i.buffer===r.n.buffer||(i=new Uint8Array(r.n.buffer)),i}let s=0;let c=new TextDecoder("utf-8");function u(t,e){return c.decode(o().subarray(t,t+e))}const l=new Array(32);l.fill(void 0),l.push(void 0,null,!0,!1);let a=l.length;function h(t){const e=function(t){return l[t]}(t);return function(t){t<36||(l[t]=a,a=t)}(t),e}class d{static __wrap(t){const e=Object.create(d.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,r.a(t)}static new(){const t=r.e();return d.__wrap(t)}reset(){r.f(this.ptr)}cycle(){r.c(this.ptr)}load(t){r.d(this.ptr,function(t){const e=r.b(1*t.length);return o().set(t,e/1),s=t.length,e}(t),s)}screen_buffer(){return r.g(this.ptr)}sound(){return 0!==r.l(this.ptr)}update_timers(){r.m(this.ptr)}set_key(t,e){r.h(this.ptr,t,e)}set_load_store_quirk(t){r.i(this.ptr,t)}set_shift_quirk(t){r.j(this.ptr,t)}set_wrapping(t){r.k(this.ptr,t)}}const f=function(t,e){return function(t){a===l.length&&l.push(l.length+1);const e=a;return a=l[e],l[e]=t,e}(u(t,e))},p="function"==typeof Math.random?Math.random:(y="Math.random",()=>{throw new Error(`${y} is not defined`)});var y;const m=function(t,e){throw new Error(u(t,e))},w=function(t){throw h(t)}},function(t,e,n){"use strict";var r=n.w[t.i];t.exports=r;n(2);r.o()}]]);